## 个性化词云生成方案

### 问题分析

1. 当前词云基于用户评论生成，若用户无评论则词云为空
2. 用户希望基于偏好主题生成个性化词云，无需全局默认值
3. 用户偏好已存储在数据库中，包含主题ID和偏好分数
4. 每个主题对应有相关关键词列表

### 解决方案

修改词云生成API，基于用户偏好主题和主题关键词生成个性化词云：

1. **获取用户偏好**：从数据库读取用户的偏好主题和分数
2. **主题关键词映射**：为每个偏好主题关联对应的关键词
3. **生成个性化词云数据**：

   * 主题关键词权重 = 主题偏好分数 × 100

   * 根据权重生成词频数据
4. **格式转换**：转换为ECharts词云所需格式

### 修改文件

* **`c:\PostG\backend\app.py`**：修改`get_wordcloud_data`函数，实现基于用户偏好的词云生成

### 实现逻辑

```python
def get_wordcloud_data():
    user_id = request.args.get('user_id')
    
    if user_id:
        user = User.query.filter_by(username=user_id).first()
        if user and user.preference_topics:
            # 从偏好主题生成词云
            preference = json.loads(user.preference_topics)
            processed_words = []
            
            # 遍历用户偏好的主题
            for p in preference:
                topic_id = p['topic_id']
                score = p['score']
                # 获取主题关键词
                keywords = topic_keywords.get(topic_id, [])
                # 根据偏好分数生成关键词权重
                weight = int(score * 100)
                # 将关键词重复weight次，生成词频
                processed_words.extend(keywords * weight)
            
            # 统计词频
            word_counts = Counter(processed_words)
            # 转换为ECharts格式
            data = [{"name": w, "value": c} for w, c in word_counts.most_common(100)]
            return jsonify(data)
    
    # 若用户无偏好，返回空词云
    return jsonify([])
```

### 预期效果

* 每个用户的词云基于其偏好主题生成

* 偏好分数越高的主题，其关键词在词云中出现频率越高

* 无评论用户也能看到个性化词云

* 无需使用全局词云作为默认值

